# ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ CSV –∫–æ–¥–æ–≤ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞:
```
null value in column "student_id" of relation "grade8_codes" violates not-null constraint
```

## –ü—Ä–∏—á–∏–Ω–∞

–í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–µ `grade8_codes.student_id` –∏–º–µ–µ—Ç constraint NOT NULL, –Ω–æ –≤ –∫–æ–¥–µ –º–æ–¥–µ–ª–∏ —ç—Ç–æ –ø–æ–ª–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∫–∞–∫ `nullable=True`. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –±—ã–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–∏.

## –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: SQL —Å–∫—Ä–∏–ø—Ç (–±—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ PostgreSQL
psql -U postgres olympus_bot

# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É
ALTER TABLE grade8_codes ALTER COLUMN student_id DROP NOT NULL;

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
\d grade8_codes

# –í—ã–π–¥–∏—Ç–µ
\q
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–π SQL —Ñ–∞–π–ª

```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç
psql -U postgres olympus_bot < fix_grade8_codes.sql
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞)

```bash
# –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ!

# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ PostgreSQL
psql -U postgres

# –£–¥–∞–ª–∏—Ç–µ –±–∞–∑—É
DROP DATABASE IF EXISTS olympus_bot;

# –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–Ω–æ–≤–æ
CREATE DATABASE olympus_bot;

# –í—ã–π–¥–∏—Ç–µ
\q

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü
python bot/main.py
# (–Ω–∞–∂–º–∏—Ç–µ Ctrl+C –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü)
```

---

## –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ API —Å–µ—Ä–≤–µ—Ä:
```bash
python api/main.py
```

2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å CSV —Ñ–∞–π–ª—ã —Å–Ω–æ–≤–∞ —á–µ—Ä–µ–∑ –≤–µ–±-–ø–∞–Ω–µ–ª—å:
   - –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8000/
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Ç–∞–± "üîë –ö–æ–¥—ã"
   - –í—ã–±–µ—Ä–∏—Ç–µ CSV —Ñ–∞–π–ª—ã
   - –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–¥—ã"

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –±–∞–∑–µ
psql -U postgres olympus_bot

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã
\d grade8_codes

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# student_id | integer | | nullable
#            ^^^^^^^^^^^^ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–µ–∑ "not null"

# –í—ã–π–¥–∏—Ç–µ
\q
```

---

## –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ?

1. –ú–æ–¥–µ–ª—å –≤ –∫–æ–¥–µ –±—ã–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∞: `student_id` —Å—Ç–∞–ª `nullable=True` (—Å—Ç—Ä–æ–∫–∞ 58 –≤ `database/models.py`)
2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –±—ã–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
3. SQLAlchemy –Ω–µ —Å–æ–∑–¥–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ - –Ω—É–∂–Ω–æ –ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Alembic, –ª–∏–±–æ –≤—Ä—É—á–Ω—É—é –∏–∑–º–µ–Ω—è—Ç—å —Å—Ö–µ–º—É

---

## –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –≤ –±—É–¥—É—â–µ–º

### –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Alembic –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Alembic
pip install alembic

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ
alembic init alembic

# –°–æ–∑–¥–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
alembic revision --autogenerate -m "Make student_id nullable in grade8_codes"

# –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
alembic upgrade head
```

### –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

–í `database/database.py` –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

```python
async def init_db():
    async with engine.begin() as conn:
        # –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏!)
        await conn.run_sync(Base.metadata.drop_all)
        await conn.run_sync(Base.metadata.create_all)
```

‚ö†Ô∏è **–í–ù–ò–ú–ê–ù–ò–ï**: –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.

---

## –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å PostgreSQL:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω
brew services list | grep postgresql
# –∏–ª–∏
sudo systemctl status postgresql

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –µ—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω
brew services start postgresql
# –∏–ª–∏
sudo systemctl start postgresql

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
psql -U postgres -c "SELECT version();"
```

---

**–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –í—ã—Å–æ–∫–∏–π (–±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –∫–æ–¥–æ–≤)
**–†–µ—à–µ–Ω–∏–µ**: 1 –º–∏–Ω—É—Ç–∞ (–æ–¥–Ω–∞ SQL –∫–æ–º–∞–Ω–¥–∞)
